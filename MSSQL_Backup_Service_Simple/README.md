# MSSQL 备份服务 (客户端)

这是一个独立的 Python 客户端，用于执行 MSSQL 数据库的备份任务。它被设计为与主 Web 服务（OBS Monitor Docker）协同工作，通过 API 获取其特定的备份配置并执行任务。

## 核心特性

- **中心化配置**: 客户端从主 Web 服务动态获取所有备份参数，无需在本地进行复杂的配置。
- **按需紧急备份**: 除了按计划执行备份，客户端还会定期轮询主服务，以响应从 Web 界面触发的“紧急备份”请求。
- **状态报告**: 紧急备份完成后，客户端会向主服务报告其完成状态。
- **日志记录**: 为每个任务实例生成详细的日志文件，记录所有备份和上传活动。

## 安装与配置

### 1. 安装依赖

在运行此客户端的服务器上，您需要安装 Python 和一些必要的库。

```bash
pip install requests esdk-obs-python
```

### 2. 获取任务 ID

每一个备份客户端都与主服务上的一个“任务”相关联。

1.  登录主服务的 Web 界面 (例如 `http://your_server_ip:3001`)。
2.  导航到“任务配置”页面。
3.  找到您希望此客户端执行的任务，并从任务卡片上复制其 **唯一 ID** (一个16位的字符串)。

### 3. 配置客户端

1.  将 `settings.ini.example` 文件复制并重命名为 `settings.ini`。
2.  打开 `settings.ini` 并填写以下字段：
    - `server_url`: 您的主 Web 服务的地址 (例如 `http://192.168.1.100:3001`)。
    - `task_id`: 您在上一步中复制的唯一任务 ID。
    - `api_key`: 用于和主服务进行安全通信的 API 密钥。这个值必须与主服务 `middleware/auth.middleware.js` 中定义的 `API_KEY` 完全一致。

## 如何运行

完成配置后，只需在 `MSSQL_Backup_Service_Simple` 目录下运行 Python 脚本即可启动服务：

```bash
python backup_service.py
```

服务启动后，它将：
-   立即从主服务获取其任务配置。
-   根据配置中的时间安排，执行**计划备份**。
-   每隔 15 秒检查一次**紧急备份**请求。

您可以为不同的任务配置多个客户端实例，只需为每个实例提供一个包含其独有 `task_id` 的 `settings.ini` 文件即可。
