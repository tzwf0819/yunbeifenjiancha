# 紧急备份工具使用指南

## 🚨 紧急备份工具介绍

项目提供了多种紧急备份方式，满足不同场景的需求：

### 1. 📋 交互式紧急备份 (推荐)
**文件**: `emergency_backup.bat`
- ✅ 用户友好的图形界面
- ✅ 可选择备份特定数据库或全部数据库
- ✅ 实时显示备份进度和结果
- ✅ 查看备份历史和日志
- ✅ 包含详细的错误诊断

**使用方法**:
```cmd
emergency_backup.bat
```

### 2. 🐍 Python交互式工具
**文件**: `emergency_backup.py`
- ✅ 功能最全面的备份工具
- ✅ 支持单个/批量数据库备份
- ✅ 备份历史查看
- ✅ 实时日志显示
- ✅ 自动和交互两种模式

**使用方法**:
```cmd
# 交互模式
python emergency_backup.py

# 自动模式 (无交互，直接备份所有)
python emergency_backup.py --auto
```

### 3. ⚡ 快速备份
**文件**: `quick_backup.bat`
- ✅ 最快速的备份方式
- ✅ 无需用户确认，直接执行
- ✅ 适合自动化脚本调用
- ✅ 返回执行结果代码

**使用方法**:
```cmd
quick_backup.bat
```

### 4. 🖥️ 命令行直接调用
**调用**: `python backup_service.py --emergency`
- ✅ 最简单的方式
- ✅ 适合集成到其他脚本
- ✅ 返回标准退出代码

## 📊 功能对比

| 功能 | emergency_backup.bat | emergency_backup.py | quick_backup.bat | 命令行调用 |
|------|---------------------|-------------------|-----------------|-----------|
| 交互界面 | ✅ | ✅ | ❌ | ❌ |
| 选择性备份 | ✅ | ✅ | ❌ | ❌ |
| 备份历史查看 | ❌ | ✅ | ❌ | ❌ |
| 日志查看 | ✅ | ✅ | ❌ | ❌ |
| 执行速度 | 中等 | 中等 | 最快 | 最快 |
| 错误诊断 | ✅ | ✅ | 基础 | 基础 |
| 自动化友好 | ❌ | ✅ | ✅ | ✅ |

## 🎯 使用场景推荐

### 日常手动备份
**推荐**: `emergency_backup.bat`
- 提供清晰的界面和操作提示
- 可以选择备份特定数据库
- 显示详细的执行结果

### 自动化脚本集成
**推荐**: `quick_backup.bat` 或 `python backup_service.py --emergency`
- 无需人工干预
- 快速执行
- 返回标准退出代码

### 故障诊断和管理
**推荐**: `python emergency_backup.py`
- 最全面的功能
- 可以查看历史和日志
- 支持单个数据库测试

### 计划任务调用
**推荐**: `python emergency_backup.py --auto`
- 自动模式，无交互
- 完整的日志记录
- 可靠的错误处理

## 🔧 交互式工具详细功能

### 主菜单选项
```
1. 查看可备份数据库列表    # 显示所有启用的数据库配置
2. 备份指定数据库         # 选择单个数据库进行备份
3. 备份所有数据库         # 备份所有启用的数据库
4. 查看备份历史          # 显示本地备份文件列表
5. 查看备份日志          # 显示最近的操作日志
0. 退出                 # 退出工具
```

### 备份过程显示
- ✅ 实时进度显示
- ✅ 每个步骤的成功/失败状态
- ✅ 备份文件大小和位置
- ✅ OBS上传结果
- ✅ 总体统计信息

### 错误诊断提示
当备份失败时，工具会提示检查：
1. 数据库连接配置是否正确
2. SQL Server服务是否正在运行  
3. sqlcmd工具是否已安装
4. 华为云OBS配置是否正确
5. 网络连接是否正常

## 🚀 快速上手示例

### 场景1：第一次使用，想了解有哪些数据库
```cmd
emergency_backup.bat
# 选择 "1" 查看数据库列表
# 选择 "2" 备份单个数据库进行测试
```

### 场景2：定期手动备份所有数据库
```cmd
emergency_backup.bat
# 选择 "3" 备份所有数据库
# 确认后自动执行
```

### 场景3：快速备份不想等待确认
```cmd
quick_backup.bat
# 直接执行，无需确认
```

### 场景4：集成到其他脚本
```cmd
call quick_backup.bat
if %errorlevel% equ 0 (
    echo 备份成功
) else (
    echo 备份失败，请检查日志
)
```

## 📝 注意事项

1. **权限要求**: 确保有数据库访问权限和本地文件写入权限
2. **网络要求**: OBS上传需要稳定的网络连接
3. **磁盘空间**: 确保有足够空间存储备份文件
4. **sqlcmd工具**: 必须安装SQL Server命令行工具
5. **配置文件**: 确保config.ini配置正确

## 🔍 故障排除

### 常见问题
- **"找不到sqlcmd命令"**: 安装SQL Server Management Tools
- **"数据库连接失败"**: 检查服务器地址、用户名、密码
- **"OBS上传失败"**: 检查access_key、secret_key、网络连接
- **"权限不足"**: 确保对backup目录有写权限

### 日志查看
所有备份操作都会记录到 `backup_service.log` 文件中，可以通过交互式工具查看最近的日志内容。

---
**提示**: 建议先使用交互式工具 `emergency_backup.bat` 熟悉功能，然后根据需要选择合适的备份方式。